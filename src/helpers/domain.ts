const awsTlds = [
  'ac',
  'academy',
  'accountants',
  'adult',
  'agency',
  'apartments',
  'associates',
  'auction',
  'audio',
  'band',
  'bargains',
  'be',
  'berlin',
  'bike',
  'bingo',
  'biz',
  'black',
  'blue',
  'boutique',
  'builders',
  'business',
  'buzz',
  'ca',
  'cab',
  'cafe',
  'camera',
  'camp',
  'capital',
  'cards',
  'care',
  'careers',
  'cash',
  'casino',
  'catering',
  'cc',
  'center',
  'ceo',
  'ch',
  'chat',
  'cheap',
  'church',
  'city',
  'cl',
  'cloud',
  'claims',
  'cleaning',
  'click',
  'clinic',
  'clothing',
  'club',
  'co',
  'co.nz',
  'co.uk',
  'co.za',
  'coach',
  'codes',
  'coffee',
  'college',
  'com',
  'com.ar',
  'com.au',
  'com.br',
  'com.mx',
  'com.sg',
  'community',
  'company',
  'computer',
  'condos',
  'construction',
  'consulting',
  'contractors',
  'cool',
  'coupons',
  'credit',
  'creditcard',
  'cruises',
  'dance',
  'dating',
  'de',
  'deals',
  'delivery',
  'democrat',
  'dental',
  'diamonds',
  'diet',
  'digital',
  'direct',
  'directory',
  'discount',
  'dog',
  'domains',
  'education',
  'email',
  'energy',
  'engineering',
  'enterprises',
  'equipment',
  'es',
  'estate',
  'eu',
  'events',
  'exchange',
  'expert',
  'exposed',
  'express',
  'fail',
  'farm',
  'fi',
  'finance',
  'financial',
  'fish',
  'fitness',
  'flights',
  'florist',
  'flowers',
  'fm',
  'football',
  'forsale',
  'foundation',
  'fr',
  'fund',
  'furniture',
  'futbol',
  'fyi',
  'gallery',
  'gg',
  'gift',
  'gifts',
  'glass',
  'global',
  'gold',
  'golf',
  'graphics',
  'gratis',
  'green',
  'gripe',
  'guide',
  'guitars',
  'guru',
  'haus',
  'healthcare',
  'help',
  'hiv',
  'hockey',
  'holdings',
  'holiday',
  'host',
  'hosting',
  'house',
  'im',
  'immo',
  'immobilien',
  'in',
  'industries',
  'info',
  'ink',
  'institute',
  'insure',
  'international',
  'investments',
  'io',
  'irish',
  'it',
  'jewelry',
  'jp',
  'juegos',
  'kaufen',
  'kim',
  'kitchen',
  'kiwi',
  'land',
  'lease',
  'legal',
  'lgbt',
  'life',
  'lighting',
  'limited',
  'limo',
  'link',
  'live',
  'loan',
  'loans',
  'lol',
  'maison',
  'management',
  'marketing',
  'mba',
  'me',
  'me.uk',
  'media',
  'memorial',
  'mobi',
  'moda',
  'money',
  'mortgage',
  'movie',
  'mx',
  'name',
  'net',
  'net.au',
  'net.nz',
  'network',
  'news',
  'ninja',
  'nl',
  'onl',
  'online',
  'org',
  'org.nz',
  'org.uk',
  'partners',
  'parts',
  'photo',
  'photography',
  'photos',
  'pics',
  'pictures',
  'pink',
  'pizza',
  'place',
  'plumbing',
  'plus',
  'poker',
  'porn',
  'pro',
  'productions',
  'properties',
  'property',
  'pub',
  'qa',
  'qpon',
  'recipes',
  'red',
  'reise',
  'reisen',
  'rentals',
  'repair',
  'report',
  'republican',
  'restaurant',
  'reviews',
  'rip',
  'rocks',
  'ru',
  'ruhr',
  'run',
  'sale',
  'sarl',
  'school',
  'schule',
  'se',
  'services',
  'sex',
  'sexy',
  'sg',
  'sh',
  'shiksha',
  'shoes',
  'show',
  'singles',
  'soccer',
  'social',
  'solar',
  'solutions',
  'studio',
  'style',
  'sucks',
  'supplies',
  'supply',
  'support',
  'surgery',
  'systems',
  'tattoo',
  'tax',
  'taxi',
  'team',
  'technology',
  'tennis',
  'theater',
  'tienda',
  'tips',
  'tires',
  'today',
  'tools',
  'tours',
  'town',
  'toys',
  'trade',
  'training',
  'tv',
  'uk',
  'university',
  'uno',
  'us',
  'vacations',
  'vc',
  'vegas',
  'ventures',
  'vg',
  'viajes',
  'video',
  'villas',
  'vision',
  'voyage',
  'watch',
  'website',
  'wien',
  'wiki',
  'works',
  'world',
  'wtf',
  'xyz',
  'zone',
]

const checkDomainSegment = (value: string): void => {
  if (value.startsWith('-')) {
    throw new Error('Domain segment cannot begin with a hyphen.')
  }

  if (value.endsWith('-')) {
    throw new Error('Domain segment cannot end with a hyphen.')
  }

  if (!/^[a-z0-9-]+$/.test(value.toLowerCase())) {
    throw new Error(
      'Domain segments can only contain letters, numbers, and hyphens.',
    )
  }
}

interface GetDomainInfo {
  isSubdomain: boolean
  tld: string
  sld: string
  subdomains?: string
}

export const getDomainInfo = (value: string): GetDomainInfo => {
  const tld = awsTlds.find((_tld) => value.endsWith(_tld))
  if (!tld) {
    throw new Error('Invalid TLD.')
  }
  const rest = value.split(`.${tld}`)[0]

  rest.split('.').forEach(checkDomainSegment)

  if (rest.includes('.')) {
    const [subdomains, sld] = rest.split(/\.(.+)/)

    return {
      isSubdomain: true,
      tld,
      sld,
      subdomains,
    }
  }

  return {
    isSubdomain: false,
    tld,
    sld: rest,
  }
}

export const validateDomain = (value: string): string | true => {
  try {
    getDomainInfo(value)
    return true
  } catch (err) {
    return err.message
  }
}
